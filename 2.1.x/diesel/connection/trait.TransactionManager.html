<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Manages the internal transaction state for a connection."><title>TransactionManager in diesel::connection - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-081576b923113409.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="diesel" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0-nightly (e3181b091 2024-04-18)" data-channel="nightly" data-search-js="search-5b46ae87cc198d72.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../diesel/index.html">diesel</a><span class="version">2.1.6</span></h2></div><h2 class="location"><a href="#">TransactionManager</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.TransactionStateData">TransactionStateData</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.begin_transaction">begin_transaction</a></li><li><a href="#tymethod.commit_transaction">commit_transaction</a></li><li><a href="#tymethod.rollback_transaction">rollback_transaction</a></li><li><a href="#tymethod.transaction_manager_status_mut">transaction_manager_status_mut</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.is_broken_transaction_manager">is_broken_transaction_manager</a></li><li><a href="#method.transaction">transaction</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In diesel::connection</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../diesel/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">diesel</a>::<wbr><a href="index.html">connection</a>::<wbr><a class="trait" href="#">TransactionManager</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/diesel/connection/transaction_manager.rs.html#10-101">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait TransactionManager&lt;Conn: <a class="trait" href="../prelude/trait.Connection.html" title="trait diesel::prelude::Connection">Connection</a>&gt; {
    type <a href="#associatedtype.TransactionStateData" class="associatedtype">TransactionStateData</a>;

    // Required methods
    fn <a href="#tymethod.begin_transaction" class="fn">begin_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.rollback_transaction" class="fn">rollback_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.commit_transaction" class="fn">commit_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.transaction_manager_status_mut" class="fn">transaction_manager_status_mut</a>(
        conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>
    ) -&gt; &amp;mut <a class="enum" href="enum.TransactionManagerStatus.html" title="enum diesel::connection::TransactionManagerStatus">TransactionManagerStatus</a>;

    // Provided methods
    fn <a href="#method.transaction" class="fn">transaction</a>&lt;F, R, E&gt;(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>, callback: F) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;R, E&gt;
       <span class="where">where F: <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;R, E&gt;,
             E: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;<a class="enum" href="../result/enum.Error.html" title="enum diesel::result::Error">Error</a>&gt;</span> { ... }
<span class="item-spacer"></span>    fn <a href="#method.is_broken_transaction_manager" class="fn">is_broken_transaction_manager</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Manages the internal transaction state for a connection.</p>
<p>You will not need to interact with this trait, unless you are writing an
implementation of <a href="../prelude/trait.Connection.html" title="trait diesel::prelude::Connection"><code>Connection</code></a>.</p>
</div></details><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.TransactionStateData" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#13">source</a><h4 class="code-header">type <a href="#associatedtype.TransactionStateData" class="associatedtype">TransactionStateData</a></h4></section></summary><div class="docblock"><p>Data stored as part of the connection implementation
to track the current transaction state of a connection</p>
</div></details></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.begin_transaction" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#20">source</a><h4 class="code-header">fn <a href="#tymethod.begin_transaction" class="fn">begin_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Begin a new transaction or savepoint</p>
<p>If the transaction depth is greater than 0,
this should create a savepoint instead.
This function is expected to increment the transaction depth by 1.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.rollback_transaction" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#27">source</a><h4 class="code-header">fn <a href="#tymethod.rollback_transaction" class="fn">rollback_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Rollback the inner-most transaction or savepoint</p>
<p>If the transaction depth is greater than 1,
this should rollback to the most recent savepoint.
This function is expected to decrement the transaction depth by 1.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.commit_transaction" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#34">source</a><h4 class="code-header">fn <a href="#tymethod.commit_transaction" class="fn">commit_transaction</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="type" href="../prelude/type.QueryResult.html" title="type diesel::prelude::QueryResult">QueryResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Commit the inner-most transaction or savepoint</p>
<p>If the transaction depth is greater than 1,
this should release the most recent savepoint.
This function is expected to decrement the transaction depth by 1.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.transaction_manager_status_mut" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#44">source</a><h4 class="code-header">fn <a href="#tymethod.transaction_manager_status_mut" class="fn">transaction_manager_status_mut</a>(
    conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>
) -&gt; &amp;mut <a class="enum" href="enum.TransactionManagerStatus.html" title="enum diesel::connection::TransactionManagerStatus">TransactionManagerStatus</a></h4></section><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>i-implement-a-third-party-backend-and-opt-into-breaking-changes</code></strong> only.</div></span></summary><div class="docblock"><p>Fetch the current transaction status as mutable</p>
<p>Used to ensure that <code>begin_test_transaction</code> is not called when already
inside of a transaction, and that operations are not run in a <code>InError</code>
transaction manager.</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.transaction" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#50-71">source</a><h4 class="code-header">fn <a href="#method.transaction" class="fn">transaction</a>&lt;F, R, E&gt;(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>, callback: F) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;R, E&gt;<div class="where">where
    F: <a class="trait" href="https://doc.rust-lang.org/nightly/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>(<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;R, E&gt;,
    E: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;<a class="enum" href="../result/enum.Error.html" title="enum diesel::result::Error">Error</a>&gt;,</div></h4></section></summary><div class="docblock"><p>Executes the given function inside of a database transaction</p>
<p>Each implementation of this function needs to fulfill the documented
behaviour of <a href="../prelude/trait.Connection.html#method.transaction" title="method diesel::prelude::Connection::transaction"><code>Connection::transaction</code></a></p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.is_broken_transaction_manager" class="method"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#83-100">source</a><h4 class="code-header">fn <a href="#method.is_broken_transaction_manager" class="fn">is_broken_transaction_manager</a>(conn: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut Conn</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></h4></section><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>i-implement-a-third-party-backend-and-opt-into-breaking-changes</code></strong> only.</div></span></summary><div class="docblock"><p>This methods checks if the connection manager is considered to be broken
by connection pool implementations</p>
<p>A connection manager is considered to be broken by default if it either
contains an open transaction (because you don’t want to have connections
with open transactions in your pool) or when the transaction manager is
in an error state.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><details class="toggle implementors-toggle"><summary><section id="impl-TransactionManager%3CConn%3E-for-AnsiTransactionManager" class="impl"><a class="src rightside" href="../../src/diesel/connection/transaction_manager.rs.html#331-494">source</a><a href="#impl-TransactionManager%3CConn%3E-for-AnsiTransactionManager" class="anchor">§</a><h3 class="code-header">impl&lt;Conn&gt; <a class="trait" href="trait.TransactionManager.html" title="trait diesel::connection::TransactionManager">TransactionManager</a>&lt;Conn&gt; for <a class="struct" href="struct.AnsiTransactionManager.html" title="struct diesel::connection::AnsiTransactionManager">AnsiTransactionManager</a><div class="where">where
    Conn: <a class="trait" href="../prelude/trait.Connection.html" title="trait diesel::prelude::Connection">Connection</a>&lt;TransactionManager = Self&gt;,</div></h3></section></summary><div class="impl-items"><section id="associatedtype.TransactionStateData-1" class="associatedtype trait-impl"><a href="#associatedtype.TransactionStateData-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.TransactionStateData" class="associatedtype">TransactionStateData</a> = <a class="struct" href="struct.AnsiTransactionManager.html" title="struct diesel::connection::AnsiTransactionManager">AnsiTransactionManager</a></h4></section></div></details></div><script src="../../trait.impl/diesel/connection/transaction_manager/trait.TransactionManager.js" async></script></section></div></main></body></html>